{% extends "base.html" %}

{% block title %}Relatório de Produtos - GetSolution{% endblock %}

{% block content %}
<div class="fade-in">
    <a href="{{ url_for('reports.index') }}" class="btn btn-secondary mb-3">Voltar para Relatórios</a>

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h2 fw-bold"><i class="bi bi-box-seam"></i> Relatório de Produtos</h1>
        
        <a href="{{ url_for('reports.export_products_csv', start_date=start_date, end_date=end_date) }}" class="btn btn-primary">
            <i class="bi bi-download"></i> Exportar CSV
        </a>
    </div>

    <div class="card mb-4 shadow-sm">
        <div class="card-body">
            <form action="{{ url_for('reports.products') }}" method="GET" class="row g-3 align-items-end">
                <div class="col-md-5">
                    <label for="start_date" class="form-label">Data de Início</label>
                    <input type="date" class="form-control" id="start_date" name="start_date" value="{{ start_date }}">
                </div>
                <div class="col-md-5">
                    <label for="end_date" class="form-label">Data de Fim</label>
                    <input type="date" class="form-control" id="end_date" name="end_date" value="{{ end_date }}">
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-primary w-100">Filtrar</button>
                </div>
            </form>
        </div>
    </div>

    <div class="card shadow-sm">
        <div class="card-header bg-white fw-bold">
            Produtos Mais Vendidos ({{ top_products | length }} Itens)
        </div>
        <div class="card-body">
            {% if top_products %}
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Nome do Produto</th>
                            <th>Categoria</th>
                            <th class="text-end">Quantidade Vendida</th>
                            <th class="text-end">Receita Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for product in top_products %}
                        <tr>
                            <td>{{ loop.index }}</td>
                            <td>{{ product.name }}</td>
                            <td>{{ product.category }}</td>
                            <td class="text-end">{{ product.total_sold }}</td>
                            <td class="text-end">R$ {{ "%.2f"|format(product.total_revenue) }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="text-center text-muted py-5">
                <i class="bi bi-basket display-4"></i>
                <p class="mt-3">Nenhum produto vendido no período selecionado.</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}